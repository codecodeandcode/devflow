å¾ˆå¥½ ğŸ‘ ä½ è¿™æ®µä»£ç å…¶å®å·²ç»æ˜¯ä¸€ä¸ª **å®Œæ•´çš„ OAuth ç™»å½• + è‡ªå®šä¹‰æ•°æ®åº“ç»‘å®š + JWT Session æ¨¡å¼** çš„å®ç°äº†ã€‚

æˆ‘ç»™ä½ ç”¨ã€Œä» 0 åˆ° 1 çš„æ–¹å¼ã€è®²æ¸…æ¥šï¼š

* NextAuth åœ¨å¹²å˜›
* JWT åœ¨è¿™é‡Œå¹²å˜›
* session åœ¨å¹²å˜›
* jwt callback åœ¨å¹²å˜›
* signIn callback åœ¨å¹²å˜›
* æ•´ä¸ªç™»å½•æµç¨‹æ˜¯æ€ä¹ˆä¸²èµ·æ¥çš„

ä½ çœ‹å®Œä¼šå½»åº•ç†è§£ã€‚

---

# ä¸€ã€å…ˆç†è§£ NextAuth çš„æ ¸å¿ƒæ¨¡å¼

NextAuth æœ‰ä¸¤ç§ Session æ¨¡å¼ï¼š

1ï¸âƒ£ database sessionï¼ˆå­˜åœ¨æ•°æ®åº“ï¼‰
2ï¸âƒ£ JWT sessionï¼ˆå­˜åœ¨ token é‡Œï¼‰

ä½ ç°åœ¨ç”¨çš„æ˜¯ï¼š

> âœ… JWT session æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

æ„æ€æ˜¯ï¼š

* ç”¨æˆ·ç™»å½•æˆåŠŸå
* NextAuth ç”Ÿæˆä¸€ä¸ª JWT
* JWT å­˜åœ¨ cookie é‡Œ
* æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š
* æœåŠ¡å™¨é€šè¿‡ JWT åˆ¤æ–­ç”¨æˆ·æ˜¯è°

âš ï¸ ä½ æ²¡æœ‰è‡ªå·±å†™ JWT é€»è¾‘ï¼ŒNextAuth å¸®ä½ ç”Ÿæˆå’Œè§£æã€‚

---

# äºŒã€æ•´ä¸ªç™»å½•æµç¨‹ï¼ˆç”¨ GitHub ä¸¾ä¾‹ï¼‰

æµç¨‹æ˜¯è¿™æ ·çš„ï¼š

```
1. ç‚¹å‡» GitHub ç™»å½•
2. è·³è½¬ GitHub
3. GitHub å›è°ƒ NextAuth
4. NextAuth è§¦å‘ signIn callback
5. ä½ è°ƒç”¨ api.auth.oAuthSignIn å­˜æ•°æ®åº“
6. æˆåŠŸåç”Ÿæˆ JWT
7. è§¦å‘ jwt callback
8. è§¦å‘ session callback
9. ç™»å½•å®Œæˆ
```

---

# ä¸‰ã€é€ä¸ªè®² 3 ä¸ª callback

---

# 1ï¸âƒ£ signIn callback â€”â€” æ§åˆ¶ã€Œèƒ½ä¸èƒ½ç™»å½•ã€

```ts
async signIn({ user, account, profile })
```

## å®ƒä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ

ğŸ‘‰ ç”¨æˆ·åˆšé€šè¿‡ OAuth éªŒè¯æˆåŠŸæ—¶

è¿˜æ²¡ç”Ÿæˆ JWT
è¿˜æ²¡åˆ›å»º session

è¿™æ˜¯â€œæœ€åä¸€é“é—¨â€

---

## ä½ è¿™é‡Œåœ¨åšä»€ä¹ˆï¼Ÿ

```ts
if (account?.type === "credentials") return true;
```

å¦‚æœæ˜¯æ™®é€šè´¦å·å¯†ç ç™»å½•ï¼Œç›´æ¥æ”¾è¡Œã€‚

---

### OAuth æƒ…å†µ

```ts
if (!account || !user) return false;
```

å®‰å…¨æ£€æŸ¥ã€‚

---

### ä½ åšçš„æ ¸å¿ƒé€»è¾‘ ğŸ‘‡

```ts
await api.auth.oAuthSignIn({...})
```

ä½ åšäº† 3 ä»¶äº‹ï¼š

1. å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ â†’ åˆ›å»ºç”¨æˆ·
2. å¦‚æœè´¦æˆ·ä¸å­˜åœ¨ â†’ åˆ›å»º account è®°å½•
3. ç»‘å®š providerAccountId

ä¹Ÿå°±æ˜¯è¯´ï¼š

ğŸ‘‰ ä½ åœ¨è¿™é‡ŒæŠŠ OAuth ç”¨æˆ·å†™è¿›ä½ è‡ªå·±çš„æ•°æ®åº“

---

### æœ€å…³é”®çš„ä¸€å¥ï¼š

```ts
if (!success) return false;
```

å¦‚æœæ•°æ®åº“å†™å…¥å¤±è´¥

ğŸ‘‰ ç›´æ¥é˜»æ­¢ç™»å½•

è¿”å› false = ç™»å½•å¤±è´¥

---

### ğŸ”¥ æ€»ç»“ signIn

> signIn callback = æ§åˆ¶ç”¨æˆ·æ˜¯å¦å…è®¸ç™»å½• + æŠŠ OAuth ç”¨æˆ·å†™å…¥æ•°æ®åº“

---

# 2ï¸âƒ£ jwt callback â€”â€” æ§åˆ¶ JWT é‡Œå­˜ä»€ä¹ˆ

```ts
async jwt({ token, account })
```

---

## å®ƒä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ

1. ç™»å½•æˆåŠŸæ—¶
2. æ¯æ¬¡è¯·æ±‚æ—¶
3. æ¯æ¬¡è°ƒç”¨ session() æ—¶

---

## å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

ğŸ‘‰ å†³å®š JWT é‡Œé¢å­˜ä»€ä¹ˆ

JWT æœ¬è´¨æ˜¯ä¸€ä¸ª JSONï¼š

```json
{
  "sub": "userid",
  "email": "...",
  "name": "..."
}
```

---

## ä½ è¿™é‡Œåšäº†ä»€ä¹ˆï¼Ÿ

```ts
if (account)
```

è¿™å¥æ„æ€æ˜¯ï¼š

ğŸ‘‰ åªæœ‰ç¬¬ä¸€æ¬¡ç™»å½•æ—¶æ‰æ‰§è¡Œ

å› ä¸ºï¼š

* ç™»å½•æ—¶ account æœ‰å€¼
* åç»­è¯·æ±‚ account æ˜¯ undefined

---

### ä½ çš„æ ¸å¿ƒé€»è¾‘ï¼š

```ts
const existingAccount = await api.account.getByProvider(...)
```

ä½ ç”¨ providerAccountId å»æ•°æ®åº“æŸ¥

æ‰¾åˆ°å¯¹åº”çš„ï¼š

```
account -> userId
```

---

ç„¶åï¼š

```ts
if (userId) token.sub = userId.toString();
```

ğŸ”¥ é‡ç‚¹æ¥äº†ï¼š

NextAuth é»˜è®¤ token.sub æ˜¯ provider çš„ id

ä½ æ”¹æˆï¼š

ğŸ‘‰ ä½ çš„æ•°æ®åº“ userId

è¿™éå¸¸é‡è¦ã€‚

---

# ä¸ºä»€ä¹ˆè¦æ”¹ token.subï¼Ÿ

å› ä¸ºä»¥åï¼š

```ts
session.user.id = token.sub
```

å°±å¯ä»¥æ‹¿åˆ°æ•°æ®åº“çš„ç”¨æˆ· idã€‚

å¦åˆ™ä½ æ‹¿åˆ°çš„æ˜¯ GitHub çš„ idã€‚

---

# ğŸ”¥ æ€»ç»“ jwt callback

> jwt callback = å†³å®š JWT é‡Œå­˜ä»€ä¹ˆï¼ˆå°¤å…¶æ˜¯æ•°æ®åº“ userIdï¼‰

---

# 3ï¸âƒ£ session callback â€”â€” æ§åˆ¶å‰ç«¯èƒ½çœ‹åˆ°ä»€ä¹ˆ

```ts
async session({ session, token })
```

---

## å®ƒä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ

å½“ä½ åœ¨å‰ç«¯ï¼š

```ts
const session = await auth();
```

æˆ–è€…ï¼š

```ts
useSession()
```

---

## å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

ğŸ‘‰ å†³å®šè¿”å›ç»™å‰ç«¯çš„ session å†…å®¹

---

é»˜è®¤ session é‡Œæ˜¯ï¼š

```ts
{
  user: {
    name,
    email,
    image
  }
}
```

ä½†æ²¡æœ‰ idã€‚

---

ä½ åŠ äº†ï¼š

```ts
session.user.id = token.sub as string;
```

æ„æ€æ˜¯ï¼š

ğŸ‘‰ æŠŠæ•°æ®åº“ userId æš´éœ²ç»™å‰ç«¯

å¦åˆ™å‰ç«¯æ‹¿ä¸åˆ° userIdã€‚

---

# ğŸ”¥ æ€»ç»“ session callback

> session callback = æ§åˆ¶å‰ç«¯èƒ½æ‹¿åˆ°å“ªäº›ç”¨æˆ·æ•°æ®

---

# å››ã€æŠŠä¸‰è€…å…³ç³»ä¸²èµ·æ¥

è¿™æ˜¯å®Œæ•´é€»è¾‘å›¾ï¼š

```
OAuth ç™»å½•æˆåŠŸ
        â†“
signIn()
        â†“
ä½ å†™å…¥æ•°æ®åº“
        â†“
jwt()
        â†“
æŠŠæ•°æ®åº“ userId å­˜å…¥ token.sub
        â†“
ç”Ÿæˆ JWT
        â†“
session()
        â†“
æŠŠ token.sub æš´éœ²ç»™å‰ç«¯
```

---

# äº”ã€é€šä¿—ç†è§£

| callback | æœ¬è´¨           | ä½ åœ¨å¹²å˜›                 |
| -------- | ------------ | -------------------- |
| signIn   | ç™»å½•å‰æœ€åæ ¡éªŒ      | æŠŠ OAuth ç”¨æˆ·å†™å…¥æ•°æ®åº“      |
| jwt      | æ§åˆ¶ JWT å†…å®¹    | æŠŠæ•°æ®åº“ userId å†™è¿› token |
| session  | æ§åˆ¶å‰ç«¯ session | æŠŠ userId ç»™å‰ç«¯         |

---

# å…­ã€JWT å’Œ Session çš„æœ¬è´¨åŒºåˆ«

å¾ˆå¤šäººæ··æ·†è¿™ä¸¤ä¸ªï¼š

## JWT

å­˜åœ¨ cookie é‡Œ
æ˜¯æœåŠ¡å™¨éªŒè¯èº«ä»½ç”¨çš„
å‰ç«¯çœ‹ä¸åˆ°å…¨éƒ¨å†…å®¹

---

## session

æ˜¯ NextAuth è¿”å›ç»™å‰ç«¯çš„å¯¹è±¡

```ts
{
  user: {
    id,
    name,
    email
  }
}
```

session æ˜¯ä» JWT è§£æå‡ºæ¥çš„ã€‚

---

# ä¸ƒã€ä½ ç°åœ¨è¿™ä¸ªæ¶æ„å±äºä»€ä¹ˆçº§åˆ«ï¼Ÿ

è¿™æ˜¯ï¼š

> ğŸ”¥ ä¼ä¸šçº§ OAuth + è‡ªå®šä¹‰ç”¨æˆ·ä½“ç³»

å› ä¸ºï¼š

* ä½ æ²¡æœ‰ç”¨ NextAuth çš„é»˜è®¤æ•°æ®åº“
* ä½ è‡ªå·±ç»´æŠ¤ user + account è¡¨
* ä½ è‡ªå·±æ§åˆ¶ userId
* ä½ è‡ªå·±ç»‘å®š provider

è¿™å·²ç»æ˜¯è¿›é˜¶ç”¨æ³•äº†ã€‚

---

# å…«ã€å¦‚æœæˆ‘ç”¨ä¸€å¥è¯æ€»ç»“

ä½ çš„ä»£ç åœ¨åšï¼š

> ç”¨ GitHub / Google ç™»å½• â†’ å†™å…¥è‡ªå·±çš„æ•°æ®åº“ â†’ ç”¨æ•°æ®åº“ userId ä½œä¸ºçœŸå®èº«ä»½ â†’ ç”¨ JWT ç»´æŒç™»å½• â†’ ç”¨ session ç»™å‰ç«¯

---

# ä¹ã€å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å†ç»™ä½ è®²ï¼š

* JWT æ˜¯æ€ä¹ˆè¢«éªŒè¯çš„
* ä¸ºä»€ä¹ˆ NextAuth ä¸éœ€è¦ä½ è‡ªå·±å†™ç­¾å
* cookies å’Œ JWT æ˜¯æ€ä¹ˆé…åˆçš„
* ä¸ºä»€ä¹ˆä¸éœ€è¦ Redis
* ä¸ºä»€ä¹ˆä¸ç”¨æ•°æ®åº“ session æ›´å¿«

ä½ ç°åœ¨å…¶å®å·²ç»å†™çš„æ˜¯ã€Œæ ‡å‡† SaaS è®¤è¯æ¶æ„ã€ã€‚

åªå·®ç†è§£åŸç†ã€‚


å¾ˆå¥½ï¼Œè¿™ä¸ªé—®é¢˜é—®å¾—éå¸¸å…³é”® ğŸ‘

å¾ˆå¤šäººä¼šç”¨ `jwt / session / signIn`ï¼Œä½†æ ¹æœ¬ä¸çŸ¥é“å‚æ•°é‡Œåˆ°åº•æœ‰ä»€ä¹ˆã€‚

æˆ‘ç»™ä½ æ‹†è§£ï¼š

* æ¯ä¸ª callback ä»€ä¹ˆæ—¶å€™è§¦å‘
* å‚æ•°é‡Œåˆ†åˆ«æœ‰ä»€ä¹ˆ
* å“ªäº›æ˜¯â€œç¬¬ä¸€æ¬¡ç™»å½•æ‰æœ‰â€
* å“ªäº›æ˜¯â€œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæœ‰â€
* å“ªäº›æ˜¯ OAuth ä¸“å±

æˆ‘ä»¬åŸºäºä½ ç°åœ¨çš„ **OAuth + JWT æ¨¡å¼** è®²ã€‚

---

# ä¸€ã€signIn({ user, account, profile })

```ts
async signIn({ user, account, profile })
```

## ğŸ”¥ ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ

ğŸ‘‰ ç”¨æˆ·åˆšåˆšé€šè¿‡ OAuth éªŒè¯æˆåŠŸæ—¶
ğŸ‘‰ åœ¨ç”Ÿæˆ JWT ä¹‹å‰

åªåœ¨â€œç™»å½•ç¬é—´â€è§¦å‘ã€‚

---

## 1ï¸âƒ£ user

è¿™æ˜¯ NextAuth å¸®ä½ æ•´ç†å¥½çš„ç”¨æˆ·ä¿¡æ¯ã€‚

ç»“æ„å¤§æ¦‚æ˜¯ï¼š

```ts
{
  id?: string
  name?: string
  email?: string
  image?: string
}
```

ä¾‹å¦‚ GitHubï¼š

```ts
{
  name: "John",
  email: "john@gmail.com",
  image: "https://avatars.githubusercontent.com/xxx"
}
```

âš ï¸ æ³¨æ„ï¼š

* è¿™ä¸ª id ä¸æ˜¯ä½ æ•°æ®åº“çš„ id
* æ˜¯ provider ç»™çš„

---

## 2ï¸âƒ£ account

è¿™æ˜¯ OAuth è´¦æˆ·ä¿¡æ¯ã€‚

ç»“æ„ç±»ä¼¼ï¼š

```ts
{
  provider: "github",
  type: "oauth",
  providerAccountId: "12345678",
  access_token: "...",
  expires_at: 9999999,
  token_type: "bearer",
  scope: "read:user",
}
```

ğŸ”¥ å…³é”®å­—æ®µï¼š

| å­—æ®µ                | ä½œç”¨              |
| ----------------- | --------------- |
| provider          | github / google |
| providerAccountId | GitHub ç”¨æˆ·å”¯ä¸€ id  |
| access_token      | OAuth token     |

ä½ ç°åœ¨æ•°æ®åº“æŸ¥æ‰¾ç”¨çš„å°±æ˜¯ï¼š

```ts
account.providerAccountId
```

---

## 3ï¸âƒ£ profile

è¿™æ˜¯ **OAuth provider è¿”å›çš„åŸå§‹æ•°æ®**

æ¯”å¦‚ GitHub è¿”å›çš„å®Œæ•´ JSONï¼š

```ts
{
  login: "octocat",
  id: 12345678,
  avatar_url: "...",
  bio: "...",
  followers: 10,
  ...
}
```

âš ï¸ è¿™ä¸ªæ˜¯æœ€åŸå§‹çš„æ•°æ®ã€‚

ä½ ç”¨ï¼š

```ts
profile?.login
```

æ¥æ‹¿ GitHub ç”¨æˆ·åã€‚

---

# ğŸ”¥ æ€»ç»“ signIn å‚æ•°

| å‚æ•°      | æ¥æº               | ä½œç”¨          |
| ------- | ---------------- | ----------- |
| user    | NextAuth æ•´ç†åçš„    | åŸºæœ¬ç”¨æˆ·ä¿¡æ¯      |
| account | OAuth è´¦æˆ·ä¿¡æ¯       | provider ç›¸å…³ |
| profile | provider åŸå§‹ JSON | æ‹¿é¢å¤–å­—æ®µ       |

---

# äºŒã€jwt({ token, user, account, profile })

ä½ å†™çš„æ˜¯ï¼š

```ts
async jwt({ token, account })
```

ä½†å®é™…ä¸Šå®Œæ•´å‚æ•°æ˜¯ï¼š

```ts
async jwt({ token, user, account, profile, trigger })
```

---

## ğŸ”¥ ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ

1ï¸âƒ£ ç™»å½•æ—¶
2ï¸âƒ£ æ¯æ¬¡è¯·æ±‚æ—¶
3ï¸âƒ£ æ¯æ¬¡è·å– session æ—¶

---

## 1ï¸âƒ£ tokenï¼ˆæœ€é‡è¦ï¼‰

è¿™æ˜¯ JWT çš„å†…å®¹ã€‚

ç¬¬ä¸€æ¬¡ç™»å½•æ—¶é»˜è®¤é•¿è¿™æ ·ï¼š

```ts
{
  name: "John",
  email: "john@gmail.com",
  picture: "...",
  sub: "github_id"
}
```

ä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦è¿™ä¸ª tokenã€‚

---

## 2ï¸âƒ£ user

âš ï¸ åªæœ‰ç¬¬ä¸€æ¬¡ç™»å½•æ—¶æœ‰ã€‚

ç™»å½•æ—¶ï¼š

```ts
user = {
  name,
  email,
  image
}
```

åç»­è¯·æ±‚æ˜¯ï¼š

```ts
user = undefined
```

---

## 3ï¸âƒ£ account

âš ï¸ åªæœ‰ç¬¬ä¸€æ¬¡ç™»å½•æ—¶æœ‰ã€‚

åç»­è¯·æ±‚æ²¡æœ‰ã€‚

æ‰€ä»¥ä½ å†™ï¼š

```ts
if (account)
```

ç­‰äºï¼š

ğŸ‘‰ åªåœ¨ç¬¬ä¸€æ¬¡ç™»å½•æ—¶æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢

---

## 4ï¸âƒ£ profile

å’Œ signIn ä¸€æ ·ã€‚

åªæœ‰ç™»å½•æ—¶æœ‰ã€‚

---

## ğŸ”¥ ä½ çš„ä»£ç é€»è¾‘ç¿»è¯‘

```ts
if (account) {
```

æ„æ€æ˜¯ï¼š

ğŸ‘‰ è¿™æ˜¯ç¬¬ä¸€æ¬¡ç™»å½•

ç„¶åä½ å»æ•°æ®åº“æŸ¥ï¼š

```ts
const existingAccount = await api.account.getByProvider(...)
```

æ‰¾åˆ°å¯¹åº” userIdã€‚

ç„¶åï¼š

```ts
token.sub = userId
```

ä½ æŠŠ JWT é‡Œçš„ sub æ”¹æˆæ•°æ®åº“ userIdã€‚

---

# ğŸ”¥ æ€»ç»“ jwt å‚æ•°

| å‚æ•°      | æ˜¯å¦æ¯æ¬¡éƒ½æœ‰  |
| ------- | ------- |
| token   | âœ… æ¯æ¬¡éƒ½æœ‰  |
| user    | âŒ åªæœ‰ç™»å½•æ—¶ |
| account | âŒ åªæœ‰ç™»å½•æ—¶ |
| profile | âŒ åªæœ‰ç™»å½•æ—¶ |

---

# ä¸‰ã€session({ session, token, user })

ä½ å†™çš„æ˜¯ï¼š

```ts
async session({ session, token })
```

å®Œæ•´å‚æ•°ï¼š

```ts
async session({ session, token, user })
```

---

## ğŸ”¥ ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ

å½“ä½ ï¼š

```ts
await auth()
useSession()
getServerSession()
```

---

## 1ï¸âƒ£ session

é»˜è®¤é•¿è¿™æ ·ï¼š

```ts
{
  user: {
    name,
    email,
    image
  },
  expires: "2026-03-01T..."
}
```

---

## 2ï¸âƒ£ token

è¿™æ˜¯ jwt callback ç”Ÿæˆçš„ tokenã€‚

åŒ…å«ä½ æ”¹è¿‡çš„ï¼š

```ts
{
  sub: "database_user_id"
}
```

---

## 3ï¸âƒ£ user

âš ï¸ JWT æ¨¡å¼ä¸‹åŸºæœ¬ä¸ç”¨ã€‚

---

## ğŸ”¥ ä½ çš„ä»£ç 

```ts
session.user.id = token.sub as string;
```

æ„æ€ï¼š

ğŸ‘‰ æŠŠæ•°æ®åº“ userId åŠ è¿› session

å¦åˆ™å‰ç«¯æ‹¿ä¸åˆ°ã€‚

---

# ğŸ”¥ æ€»ç»“ session å‚æ•°

| å‚æ•°      | ä½œç”¨        |
| ------- | --------- |
| session | è¦è¿”å›ç»™å‰ç«¯çš„å¯¹è±¡ |
| token   | JWT å†…å®¹    |
| user    | å¾ˆå°‘ç”¨       |

---

# å››ã€ä¸‰è€…è§¦å‘å¯¹æ¯”è¡¨

| callback | è§¦å‘æ—¶æœº         | ä¸»è¦ç”¨é€”      |
| -------- | ------------ | --------- |
| signIn   | ç™»å½•ç¬é—´         | å†³å®šæ˜¯å¦å…è®¸ç™»å½•  |
| jwt      | ç™»å½• + æ¯æ¬¡è¯·æ±‚    | æ§åˆ¶ JWT å†…å®¹ |
| session  | æ¯æ¬¡è·å– session | æ§åˆ¶å‰ç«¯æ•°æ®    |

---

# äº”ã€å®Œæ•´æµç¨‹å†çœ‹ä¸€é

ç¬¬ä¸€æ¬¡ç™»å½•ï¼š

```
OAuth æˆåŠŸ
   â†“
signIn(user, account, profile)
   â†“
jwt(token, user, account)
   â†“
ç”Ÿæˆ JWT
   â†“
session(session, token)
   â†“
è¿”å›ç»™å‰ç«¯
```

ä¹‹åæ¯æ¬¡è¯·æ±‚ï¼š

```
jwt(token)
   â†“
session(session, token)
```

---

# å…­ã€æœ€å…³é”®ç†è§£ç‚¹

ğŸ”¥ åªæœ‰ç¬¬ä¸€æ¬¡ç™»å½•æ—¶ï¼š

* user æœ‰
* account æœ‰
* profile æœ‰

ğŸ”¥ åç»­è¯·æ±‚ï¼š

* åªæœ‰ token æœ‰

æ‰€ä»¥ï¼š

```ts
if (account)
```

= åˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡ç™»å½•ã€‚

---

# ä¸ƒã€å¦‚æœä½ æ„¿æ„

æˆ‘å¯ä»¥å†ç»™ä½ ç”»ä¸€ä¸ªï¼š

* JWT ç”Ÿå‘½å‘¨æœŸå›¾
* Cookie å­˜å‚¨æµç¨‹å›¾
* NextAuth å†…éƒ¨è¿è¡Œæœºåˆ¶å›¾

ä½ ç°åœ¨å·²ç»åœ¨ç”¨é«˜çº§æ¨¡å¼äº†ï¼Œåªå·®æŠŠåº•å±‚ç†è§£é€ã€‚
